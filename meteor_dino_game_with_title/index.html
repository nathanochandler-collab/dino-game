<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Meteor Dino</title>
  <style>
    html, body { height: 100%; margin: 0; background:#111; color:#eee; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    .wrap { display:grid; place-items:center; height:100%; gap:12px; }
    canvas { background:#1e1e1e; image-rendering: pixelated; image-rendering: crisp-edges; border:2px solid #333; border-radius:12px; display:none; }
    .hud { text-align:center; display:none; }
    button { background:#2e2e2e; color:#fff; border:1px solid #444; padding:10px 18px; border-radius:10px; cursor:pointer; font-size:16px; }
    button:hover { filter:brightness(1.2); }
    a { color:#8fd; }

    /* Title screen styles */
    #titleScreen {
      display:flex; flex-direction:column; justify-content:center; align-items:center;
      gap:16px; text-align:center;
    }
    #titleScreen h1 {
      font-size: 48px;
      margin: 0;
      color: #f5f5f5;
      text-shadow: 0 0 8px #ff8844, 0 0 14px #ffaa66;
    }
    #startBtn {
      background: linear-gradient(45deg, #ff6600, #ffcc00);
      border: none;
      padding: 14px 28px;
      font-size: 20px;
      font-weight: bold;
      border-radius: 12px;
      cursor:pointer;
      color:#111;
      box-shadow: 0 0 12px #ff8800;
      transition: transform 0.15s ease, filter 0.2s ease;
    }
    #startBtn:hover {
      transform: scale(1.05);
      filter: brightness(1.2);
    }
    #instructions {
      font-size:14px;
      color:#ccc;
    }
  </style>
</head>
<body>
<div class="wrap">
  <!-- Title Screen -->
  <div id="titleScreen">
    <h1>Meteor Dino</h1>
    <button id="startBtn">Start Game</button>
    <div id="instructions">Use ◄ ► arrow keys to dodge meteors</div>
  </div>

  <!-- Game -->
  <canvas id="game" width="480" height="320"></canvas>
  <div class="hud">
    <button id="restart" style="display:none">Restart (R)</button>
    <div>Move with ◄ ► arrows. Dodge meteors!</div>
  </div>
</div>

<script>
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const W = canvas.width, H = canvas.height;

  const hud = document.querySelector('.hud');
  const restartBtn = document.getElementById('restart');
  const titleScreen = document.getElementById('titleScreen');
  const startBtn = document.getElementById('startBtn');

  // Load sprites
  const dino = new Image();
  dino.src = 'dino64.png';
  const meteor = new Image();
  meteor.src = 'meteor64.png';

  let keys = { left:false, right:false };
  addEventListener('keydown', e => {
    if (e.key === 'ArrowLeft') keys.left = true;
    if (e.key === 'ArrowRight') keys.right = true;
    if (e.key.toLowerCase() === 'r') restart();
  });
  addEventListener('keyup', e => {
    if (e.key === 'ArrowLeft') keys.left = false;
    if (e.key === 'ArrowRight') keys.right = false;
  });

  // Game state
  let player, meteors, running, score, best = 0, spawnTimer, started = false;

  function restart() {
    player = { x: W/2-16, y: H-72, w: 48, h: 48, speed: 4.0 };
    meteors = [];
    score = 0;
    spawnTimer = 0;
    running = true;
    restartBtn.style.display = 'none';
  }

  function startGame() {
    titleScreen.style.display = 'none';
    canvas.style.display = 'block';
    hud.style.display = 'block';
    started = true;
    restart();
  }

  function spawnMeteor() {
    const size = 40 + Math.random()*24;
    meteors.push({
      x: Math.random()*(W - size),
      y: -size,
      w: size,
      h: size,
      vy: 2.0 + Math.random()*2.5 + Math.min(score/1500, 3.5),
      vx: (Math.random()*1.2-0.6)
    });
  }

  function rectsOverlap(a,b) {
    return a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y;
  }

  let last = performance.now();
  function loop(now) {
    const dt = (now - last) / 16.67;
    last = now;

    if (started && running) {
      if (keys.left)  player.x -= player.speed * dt;
      if (keys.right) player.x += player.speed * dt;
      player.x = Math.max(0, Math.min(W - player.w, player.x));

      spawnTimer -= dt;
      if (spawnTimer <= 0) {
        spawnMeteor();
        spawnTimer = Math.max(10 - score/300, 2.5);
      }

      for (const m of meteors) {
        m.y += m.vy * dt * 2;
        m.x += m.vx * dt * 2;
      }
      meteors = meteors.filter(m => m.y < H + 80);

      for (const m of meteors) {
        if (rectsOverlap(player, m)) {
          running = false;
          best = Math.max(best, Math.floor(score));
          restartBtn.style.display = 'inline-block';
        }
      }
      score += dt * 10;
    }

    ctx.imageSmoothingEnabled = false;
    ctx.clearRect(0,0,W,H);

    if (started) {
      ctx.fillStyle = '#0d0d0d';
      for (let y=0; y<H; y+=16) for (let x=0; x<W; x+=16) {
        ctx.fillRect(x, y, 15, 15);
      }

      ctx.drawImage(dino, 0,0,64,64, Math.round(player.x), Math.round(player.y), player.w, player.h);

      for (const m of meteors) {
        ctx.drawImage(meteor, 0,0,64,64, Math.round(m.x), Math.round(m.y), m.w, m.h);
      }

      ctx.fillStyle = '#eee';
      ctx.font = '16px monospace';
      ctx.fillText('Score: ' + Math.floor(score), 12, 22);
      ctx.fillText('Best: ' + Math.floor(best), 12, 42);
      if (!running) {
        ctx.font = '24px monospace';
        ctx.fillText('Game Over!', W/2 - 80, H/2 - 10);
        ctx.font = '14px monospace';
        ctx.fillText('Press R or click Restart', W/2 - 100, H/2 + 12);
      }
    }

    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);

  restartBtn.addEventListener('click', restart);
  startBtn.addEventListener('click', startGame);
})();
</script>
</body>
</html>
